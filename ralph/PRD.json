{
  "goal": "Automate daily content check at 2 PM UTC - only post when sources have real value",
  "phase": "Phase 2 - Production Deployment",
  "success_criteria": {
    "automated_days": 5,
    "email_alerts_configured": true,
    "monitoring_operational": true,
    "no_manual_intervention": true,
    "systemd_timer_active": true,
    "source_juice_evaluation": true
  },
  "summary": {
    "breakdown": {
      "content_logic": 1,
      "systemd": 4,
      "alerts": 3,
      "monitoring": 4,
      "validation": 3,
      "documentation": 2
    },
    "completed": 1,
    "progress_percentage": 6,
    "total_tasks": 17
  },
  "tasks": {
    "content_logic": [
      {
        "id": "logic-001",
        "description": "Implement source juice evaluation before content generation",
        "acceptance_criteria": [
          "RalphLoop._evaluate_source_juice(source_items) method exists",
          "Method uses Claude to analyze if sources are worth writing about",
          "Returns (should_proceed: bool, reason: str, juice_score: float)",
          "juice_score is 0.0-1.0 scale indicating source value",
          "Minimum juice threshold configurable via RALPH_JUICE_THRESHOLD (default 0.6)",
          "When juice_score < threshold, run() returns status='skipped_no_juice'",
          "Skip is logged to blog_agent_activity with juice_score and reason",
          "Cost of juice evaluation is ~$0.02-0.05 (small prompt)",
          "Sources with no fresh RSS items (>48 hours old) auto-fail juice check"
        ],
        "passes": true
      }
    ],
    "systemd": [
      {
        "id": "sys-001",
        "description": "Create systemd service file for ralph_loop",
        "acceptance_criteria": [
          "File /etc/systemd/system/ralph.service exists",
          "Service runs as non-root user",
          "Service loads environment from /etc/ralph/env or .env",
          "ExecStart runs: python -m ralph.ralph_loop",
          "WorkingDirectory set to project root",
          "Service type is 'oneshot' (runs once per trigger)",
          "Service can be started manually: systemctl start ralph"
        ],
        "passes": false
      },
      {
        "id": "sys-002",
        "description": "Create systemd timer for daily 2 PM UTC content check",
        "acceptance_criteria": [
          "File /etc/systemd/system/ralph.timer exists",
          "Timer triggers ralph.service daily at 2 PM UTC",
          "OnCalendar set to *-*-* 14:00:00 UTC",
          "Persistent=true (runs missed timers on boot)",
          "Timer enabled: systemctl enable ralph.timer",
          "Timer active: systemctl is-active ralph.timer shows 'active'",
          "Next trigger time shown in: systemctl list-timers ralph.timer",
          "Note: Service checks source juice first, only posts if valuable content found"
        ],
        "passes": false
      },
      {
        "id": "sys-003",
        "description": "Configure environment file for production",
        "acceptance_criteria": [
          "/etc/ralph/env exists with production secrets",
          "File permissions are 600 (owner read/write only)",
          "Contains SUPABASE_URL, SUPABASE_SECRET, ANTHROPIC_API_KEY",
          "Contains RALPH_QUALITY_THRESHOLD=0.85",
          "Contains RALPH_TIMEOUT_MINUTES=30",
          "Contains RALPH_COST_LIMIT_CENTS=100",
          "File is NOT in git repository"
        ],
        "passes": false
      },
      {
        "id": "sys-004",
        "description": "Verify systemd setup with manual trigger",
        "acceptance_criteria": [
          "systemctl start ralph.service completes without error",
          "journalctl -u ralph shows execution logs",
          "Blog post created in database after manual trigger",
          "Exit code 0 logged on successful generation",
          "Service status shows 'inactive (dead)' after completion (oneshot behavior)"
        ],
        "passes": false
      }
    ],
    "alerts": [
      {
        "id": "alert-001",
        "description": "Configure email notification service",
        "acceptance_criteria": [
          "Email provider configured (Resend.com or SMTP)",
          "EMAIL_PROVIDER env var set (resend or smtp)",
          "EMAIL_FROM and EMAIL_TO env vars configured",
          "Test email sends successfully via CLI command",
          "Credentials stored in /etc/ralph/env"
        ],
        "passes": false
      },
      {
        "id": "alert-002",
        "description": "Implement status notification in ralph_loop",
        "acceptance_criteria": [
          "On exception, email sent with error details",
          "On status='failed', email sent with quality score and reason",
          "On status='skipped_no_juice', email sent with juice_score and source summary",
          "Email includes blog_post_id for debugging (if applicable)",
          "Email includes source items evaluated (for skipped_no_juice)",
          "Notification logged to blog_agent_activity",
          "Email subject clearly indicates: [FAILED], [SKIPPED], or [ERROR]"
        ],
        "passes": false
      },
      {
        "id": "alert-003",
        "description": "Implement systemd failure notification",
        "acceptance_criteria": [
          "ralph.service has OnFailure=ralph-notify@%n.service",
          "ralph-notify@.service template exists",
          "Notification service sends email on unit failure",
          "Email includes unit name and exit code",
          "Test by intentionally causing failure"
        ],
        "passes": false
      }
    ],
    "monitoring": [
      {
        "id": "mon-001",
        "description": "Create daily generation status view",
        "acceptance_criteria": [
          "SQL view or function returns daily generation stats",
          "Shows: date, status, quality_score, iterations, cost_cents",
          "Covers last 30 days of data",
          "Can be queried via Supabase dashboard",
          "Includes success/failure counts per day"
        ],
        "passes": false
      },
      {
        "id": "mon-002",
        "description": "Create cost tracking dashboard query",
        "acceptance_criteria": [
          "Query returns daily/weekly/monthly cost totals",
          "Shows average cost per post",
          "Identifies posts exceeding cost threshold",
          "Data exportable as CSV",
          "Query documented in monitoring README"
        ],
        "passes": false
      },
      {
        "id": "mon-003",
        "description": "Create quality metrics dashboard query",
        "acceptance_criteria": [
          "Query returns average quality score by day/week",
          "Shows iteration count distribution",
          "Identifies posts below quality floor (0.70)",
          "Shows AI slop detection stats from critique logs",
          "Query documented in monitoring README"
        ],
        "passes": false
      },
      {
        "id": "mon-004",
        "description": "Create health check endpoint",
        "acceptance_criteria": [
          "GET /health returns 200 OK when system healthy",
          "Response includes last_post_date, last_post_status",
          "Response includes days_since_last_post",
          "Returns 500 if no post in last 48 hours",
          "Endpoint can be used by external monitoring (UptimeRobot, etc.)"
        ],
        "passes": false
      }
    ],
    "validation": [
      {
        "id": "val-001",
        "description": "Day 1 automated content check",
        "acceptance_criteria": [
          "Timer triggers at 2 PM UTC without manual intervention",
          "Run completes with status: 'published', 'draft', or 'skipped_no_juice'",
          "No errors in journalctl -u ralph",
          "Cost within budget (<$0.50 if posted, ~$0.05 if skipped)",
          "Activity logged to blog_agent_activity with juice evaluation"
        ],
        "passes": false
      },
      {
        "id": "val-002",
        "description": "Days 2-4 automated content checks",
        "acceptance_criteria": [
          "3 consecutive days of successful runs (post or skip)",
          "Posts have quality >= 0.70 (at minimum draft status)",
          "Skips have juice_score logged with reason",
          "No manual intervention required",
          "No duplicate posts on same day",
          "Email alert sent on each skip (skipped_no_juice)"
        ],
        "passes": false
      },
      {
        "id": "val-003",
        "description": "Day 5 validation and Phase 2 complete",
        "acceptance_criteria": [
          "5 consecutive successful automated runs",
          "System correctly posts when juice is high, skips when low",
          "Zero manual interventions required",
          "Email alerts working for skips and failures",
          "Monitoring queries return valid data including skip stats",
          "Phase 2 exit criteria fully met"
        ],
        "passes": false
      }
    ],
    "documentation": [
      {
        "id": "doc-001",
        "description": "Systemd deployment guide",
        "acceptance_criteria": [
          "docs/deployment.md exists",
          "Documents service and timer installation steps",
          "Documents environment file setup",
          "Includes troubleshooting section",
          "Includes commands for checking status and logs"
        ],
        "passes": false
      },
      {
        "id": "doc-002",
        "description": "Monitoring and alerts guide",
        "acceptance_criteria": [
          "docs/monitoring.md exists",
          "Documents email alert configuration",
          "Documents dashboard queries",
          "Includes health check usage",
          "Documents how to respond to alerts"
        ],
        "passes": false
      }
    ]
  }
}

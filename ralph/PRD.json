{
  "goal": "Automate daily blog generation at 7 AM UTC with monitoring and alerts",
  "phase": "Phase 2 - Production Deployment",
  "success_criteria": {
    "automated_days": 5,
    "email_alerts_configured": true,
    "monitoring_operational": true,
    "no_manual_intervention": true,
    "systemd_timer_active": true
  },
  "summary": {
    "breakdown": {
      "systemd": 4,
      "alerts": 3,
      "monitoring": 4,
      "validation": 3,
      "documentation": 2
    },
    "completed": 0,
    "progress_percentage": 0,
    "total_tasks": 16
  },
  "tasks": {
    "systemd": [
      {
        "id": "sys-001",
        "description": "Create systemd service file for ralph_loop",
        "acceptance_criteria": [
          "File /etc/systemd/system/ralph.service exists",
          "Service runs as non-root user",
          "Service loads environment from /etc/ralph/env or .env",
          "ExecStart runs: python -m ralph.ralph_loop",
          "WorkingDirectory set to project root",
          "Service type is 'oneshot' (runs once per trigger)",
          "Service can be started manually: systemctl start ralph"
        ],
        "passes": false
      },
      {
        "id": "sys-002",
        "description": "Create systemd timer for daily 7 AM UTC",
        "acceptance_criteria": [
          "File /etc/systemd/system/ralph.timer exists",
          "Timer triggers ralph.service",
          "OnCalendar set to *-*-* 07:00:00 UTC",
          "Persistent=true (runs missed timers on boot)",
          "Timer enabled: systemctl enable ralph.timer",
          "Timer active: systemctl is-active ralph.timer shows 'active'",
          "Next trigger time shown in: systemctl list-timers ralph.timer"
        ],
        "passes": false
      },
      {
        "id": "sys-003",
        "description": "Configure environment file for production",
        "acceptance_criteria": [
          "/etc/ralph/env exists with production secrets",
          "File permissions are 600 (owner read/write only)",
          "Contains SUPABASE_URL, SUPABASE_SECRET, ANTHROPIC_API_KEY",
          "Contains RALPH_QUALITY_THRESHOLD=0.85",
          "Contains RALPH_TIMEOUT_MINUTES=30",
          "Contains RALPH_COST_LIMIT_CENTS=100",
          "File is NOT in git repository"
        ],
        "passes": false
      },
      {
        "id": "sys-004",
        "description": "Verify systemd setup with manual trigger",
        "acceptance_criteria": [
          "systemctl start ralph.service completes without error",
          "journalctl -u ralph shows execution logs",
          "Blog post created in database after manual trigger",
          "Exit code 0 logged on successful generation",
          "Service status shows 'inactive (dead)' after completion (oneshot behavior)"
        ],
        "passes": false
      }
    ],
    "alerts": [
      {
        "id": "alert-001",
        "description": "Configure email notification service",
        "acceptance_criteria": [
          "Email provider configured (Resend.com or SMTP)",
          "EMAIL_PROVIDER env var set (resend or smtp)",
          "EMAIL_FROM and EMAIL_TO env vars configured",
          "Test email sends successfully via CLI command",
          "Credentials stored in /etc/ralph/env"
        ],
        "passes": false
      },
      {
        "id": "alert-002",
        "description": "Implement failure notification in ralph_loop",
        "acceptance_criteria": [
          "On exception, email sent with error details",
          "On status='failed', email sent with quality score and reason",
          "Email includes blog_post_id for debugging",
          "Email includes last iteration content preview",
          "Notification logged to blog_agent_activity"
        ],
        "passes": false
      },
      {
        "id": "alert-003",
        "description": "Implement systemd failure notification",
        "acceptance_criteria": [
          "ralph.service has OnFailure=ralph-notify@%n.service",
          "ralph-notify@.service template exists",
          "Notification service sends email on unit failure",
          "Email includes unit name and exit code",
          "Test by intentionally causing failure"
        ],
        "passes": false
      }
    ],
    "monitoring": [
      {
        "id": "mon-001",
        "description": "Create daily generation status view",
        "acceptance_criteria": [
          "SQL view or function returns daily generation stats",
          "Shows: date, status, quality_score, iterations, cost_cents",
          "Covers last 30 days of data",
          "Can be queried via Supabase dashboard",
          "Includes success/failure counts per day"
        ],
        "passes": false
      },
      {
        "id": "mon-002",
        "description": "Create cost tracking dashboard query",
        "acceptance_criteria": [
          "Query returns daily/weekly/monthly cost totals",
          "Shows average cost per post",
          "Identifies posts exceeding cost threshold",
          "Data exportable as CSV",
          "Query documented in monitoring README"
        ],
        "passes": false
      },
      {
        "id": "mon-003",
        "description": "Create quality metrics dashboard query",
        "acceptance_criteria": [
          "Query returns average quality score by day/week",
          "Shows iteration count distribution",
          "Identifies posts below quality floor (0.70)",
          "Shows AI slop detection stats from critique logs",
          "Query documented in monitoring README"
        ],
        "passes": false
      },
      {
        "id": "mon-004",
        "description": "Create health check endpoint",
        "acceptance_criteria": [
          "GET /health returns 200 OK when system healthy",
          "Response includes last_post_date, last_post_status",
          "Response includes days_since_last_post",
          "Returns 500 if no post in last 48 hours",
          "Endpoint can be used by external monitoring (UptimeRobot, etc.)"
        ],
        "passes": false
      }
    ],
    "validation": [
      {
        "id": "val-001",
        "description": "Day 1 automated generation",
        "acceptance_criteria": [
          "Timer triggers at 7 AM UTC without manual intervention",
          "Blog post generated with status='published' or 'draft'",
          "No errors in journalctl -u ralph",
          "Cost within budget (<$0.50)",
          "Activity logged to blog_agent_activity"
        ],
        "passes": false
      },
      {
        "id": "val-002",
        "description": "Days 2-4 automated generation",
        "acceptance_criteria": [
          "3 consecutive days of successful generation",
          "All posts have quality >= 0.70 (at minimum draft status)",
          "No manual intervention required",
          "No duplicate posts on same day",
          "Total cost for 3 days < $1.50"
        ],
        "passes": false
      },
      {
        "id": "val-003",
        "description": "Day 5 validation and Phase 2 complete",
        "acceptance_criteria": [
          "5 consecutive successful automated days",
          "At least 4 of 5 posts have status='published'",
          "Zero manual interventions required",
          "Email alerts working (test by checking alert logs)",
          "Monitoring queries return valid data",
          "Phase 2 exit criteria fully met"
        ],
        "passes": false
      }
    ],
    "documentation": [
      {
        "id": "doc-001",
        "description": "Systemd deployment guide",
        "acceptance_criteria": [
          "docs/deployment.md exists",
          "Documents service and timer installation steps",
          "Documents environment file setup",
          "Includes troubleshooting section",
          "Includes commands for checking status and logs"
        ],
        "passes": false
      },
      {
        "id": "doc-002",
        "description": "Monitoring and alerts guide",
        "acceptance_criteria": [
          "docs/monitoring.md exists",
          "Documents email alert configuration",
          "Documents dashboard queries",
          "Includes health check usage",
          "Documents how to respond to alerts"
        ],
        "passes": false
      }
    ]
  }
}
